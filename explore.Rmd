---
title: "Who We Serve"
output:
  beamer_presentation: default
  ioslides_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(googlesheets4)
library(patchwork)
library(hrbrthemes)
library(janitor)

extrafont::loadfonts()

if(!sheets_has_token()){
  sheets_auth(email = 'schneeman@gmail.com')
}

id <- NULL
if(sheets_has_token()) {
  sheet <- sheets_find(pattern = '2019 Fall Annual Survey Data_Breakdown by Scale')
  id <- sheet$id
}

survey <- sheets_get(id)

survey_df <- sheets_read(id, sheet=survey$sheet$name[1], skip = 2) %>% clean_names()
```

## Explore Austin 2019 Survey

Survey Date: 2019

## Explorer Gender Breakdown

```{r gender}
survey_df %>% group_by(gender) %>% summarize(ct = n()) %>%
  ggplot(aes(x=gender, y=ct, fill=gender)) +
  geom_col() + theme_ipsum() +
  scale_fill_ipsum() + theme(legend.position = "none")
```

## School Data
```{r school, warning = FALSE}
grades <- survey_df %>% group_by(grade) %>% summarize(ct = n()) %>%
  ggplot(aes(x=grade, y=ct)) +
  geom_col() + theme_ipsum() +
  theme(legend.position = "none") + labs(
    title = "Grade Level"
  )

lunch <- survey_df %>% mutate(do_you_receive_free_reduced_lunch = if_else(do_you_receive_free_reduced_lunch %in% c('Yes', 'No'), do_you_receive_free_reduced_lunch, "I don't know")) %>%
  group_by(do_you_receive_free_reduced_lunch) %>% summarize(ct = n()) %>%
  ggplot(aes(x=do_you_receive_free_reduced_lunch, y=ct)) +
  geom_col() + theme_ipsum() +
  theme(legend.position = "none") + labs(
    title = "Free Lunch"
  )

last_gpa <- function(gpa_string) {
  parsed <- str_split(gpa_string, "\\|", simplify = TRUE)
  parsed[length(parsed)] %>% str_trim()
}

# gotta use rowwise here to apply the function correctly
gpa <- survey_df %>% rowwise() %>%
  mutate(last_gpa = last_gpa(overall_grade_point_average_gpa_in_school)) %>% 
  group_by(last_gpa) %>% summarize(ct = n()) %>%
    ggplot(aes(x=last_gpa, y=ct)) +
  geom_col() + theme_ipsum() +
  theme(legend.position = "none") + labs(
    title = "Most Recent GPA"
  )

absences <- survey_df %>% mutate(how_many_absences_have_you_had_in_the_last_2_weeks_of_school = as.character(how_many_absences_have_you_had_in_the_last_2_weeks_of_school)) %>%
  group_by(how_many_absences_have_you_had_in_the_last_2_weeks_of_school) %>%
  summarize(ct = n()) %>%
  ggplot(aes(x=how_many_absences_have_you_had_in_the_last_2_weeks_of_school, y=ct)) +
  geom_col() + theme_ipsum() +
  theme(legend.position = "none") + labs(
    title = "Two-Week Absence Count"
  )

extracurriculars <- survey_df %>% mutate(how_many_extracurriculars_do_you_participate_in_at_school = as.character(how_many_extracurriculars_do_you_participate_in_at_school)) %>%
  group_by(how_many_extracurriculars_do_you_participate_in_at_school) %>%
  summarize(ct = n()) %>%
  ggplot(aes(x=how_many_extracurriculars_do_you_participate_in_at_school, y=ct)) +
  geom_col() + theme_ipsum() +
  theme(legend.position = "none") + labs(
    title = "Number of\nExtracurricular Activities"
  )

# arrange the plots
(grades + lunch) / (gpa + absences + extracurriculars)
```


